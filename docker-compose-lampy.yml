version: "3.4"
networks:
  proxylampy:
    external: true
  serverlampy:
    external: true
services:
  www:
    image: strapi/strapi:3.6.8-alpine
    environment:
      DATABASE_CLIENT: mysql
      DATABASE_HOST: mariadb
      DATABASE_PORT: 3306
      DATABASE_NAME: strapi_bdd
      DATABASE_USERNAME: strapi
      DATABASE_PASSWORD: password
    depends_on:
      - mariadb
    volumes:
      - ${PWD}/apps:/srv/app:delegated
    networks:
      - serverlampy
      - proxylampy
    deploy:
      labels:
        - "traefik.enable=true"
        - "traefik.http.routers.strapi.rule=Host(`strapi.traefik.me`)"
        - "traefik.http.routers.strapi-tls.tls.domains[0].main=strapi.traefik.me"
        - "traefik.http.routers.strapi.tls=true"
        - "traefik.http.services.strapi.loadbalancer.server.port=1337"