
version: "3.4"
networks:
  proxylampy:
    external: true
  net:
    driver: overlay
    attachable: true

volumes:
    mariadb_data:
services:
    strapi:
        image: strapi/strapi:3.6.5
        environment:
            DATABASE_CLIENT: mysql
            DATABASE_HOST: mariadb
            DATABASE_PORT: 3306
            DATABASE_NAME: core
            DATABASE_USERNAME: siteinternet
            DATABASE_PASSWORD: password
            DATABASE_SSL: 'false'
        volumes:
            - ./app:/srv/app
        depends_on:
            - mariadb
        networks:
            - net
            - proxylampy
        deploy:
            labels:
                - "traefik.enable=true"
                - "traefik.http.routers.strapi.rule=HostRegexp(`strapi.traefik.me`, `strapi.{ip:.*}.traefik.me`)"
                - "traefik.http.services.strapi.loadbalancer.server.port=1337"